{% extends 'layout.html' %}

{% block body %}
<div class="container" style="padding-top: 5%">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card text-center">
                <div class="card-header">
                    <h3>Emotion Detection Dashboard</h3>
                </div>
                <div class="card-body">
                    <!-- Webcam Feed -->
                    <div id="webcam-container">
                        <img id="webcam-feed" src="{{ url_for('video_feed') }}" />
                    </div>

                    <!-- Placeholder for Emotion Display -->
                    <div id="emotion-display" class="mt-3">
                        <h4>Current Emotion: <span id="emotion">Neutral</span></h4>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Include JavaScript to handle webcam feed -->
<script>
    // Access the webcam
const video = document.getElementById('webcam');

// Check if the user's browser supports mediaDevices.getUserMedia
if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
    // Request access to the webcam
    navigator.mediaDevices.getUserMedia({ video: true })
        .then(function(stream) {
            // Attach the stream to the video element
            video.srcObject = stream;
            video.play();
            document.getElementById('emotion-display').innerText = '';  // Remove any error message
        })
        .catch(function(error) {
            console.error("Error accessing webcam:", error);
            document.getElementById('emotion-display').innerText = 'Current Emotion: ';
        });
} else {
    console.warn("getUserMedia not supported on your browser!");
    document.getElementById('emotion-display').innerText = 'Webcam not supported.';
}

function updateEmotion() {
        fetch('/emotion').then(response => response.json()).then(data => {
            document.getElementById('emotion').innerText = data.emotion;
        }).catch(error => {
            console.error("Error fetching emotion data:", error);
        });
    }

    // Run the updateEmotion function every second
    setInterval(updateEmotion, 1000);
</script>

<style>
    #webcam-container {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
    }

    #webcam {
        width: 100%;
        max-width: 320px; /* Adjust the maximum width of the webcam feed */
        height: auto;
        border-radius: 10px;
        border: 3px solid #007bff;
    }

    #emotion-display {
        font-size: 1.5rem;
        font-weight: bold;
        margin-top: 20px;
    }

    .card {
        padding: 20px;
    }
</style>
{% endblock %}